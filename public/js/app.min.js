function getIdOfBox(a){return"box"+a}function callEverybodyElse(a,b){function c(a){function b(){e++,maxCALLERS>e&&a>0&&c(a-1)}function f(b,d){easyrtc.showError(b,d),maxCALLERS>e&&a>0&&c(a-1)}easyrtc.call(d[a],b,f)}console.log("otherPeople",b),console.log("roomName",a),easyrtc.setRoomOccupantListener(null);var d=[],e=0;for(var f in b)d.push(f);d.length>0&&c(d.length-1)}function loginSuccess(){console.log("Login Success")}function joinThumbVideos(a){easyrtc.joinRoom(a,null,null,null),easyrtc.enableAudio(!1),easyrtc.setRoomOccupantListener(callEverybodyElse),easyrtc.easyApp("easyrtc.multiparty","box0",["box1","box2","box3"],loginSuccess),easyrtc.setDisconnectListener(function(){easyrtc.showError("LOST-CONNECTION","Lost connection to signaling server")}),easyrtc.setOnCall(function(a,b){console.log("getConnection count="+easyrtc.getConnectionCount()),boxUsed[b+1]=!0,document.getElementById(getIdOfBox(b+1)).style.visibility="visible"}),easyrtc.setOnHangup(function(a,b){boxUsed[b+1]=!1,setTimeout(function(){document.getElementById(getIdOfBox(b+1)).style.visibility="hidden"},20)})}function viewThumbVideos(a){maxCALLERS++,numVideoOBJS=maxCALLERS+1,easyrtc.joinRoom(a,null,null,null),easyrtc.enableVideo(!1),easyrtc.setRoomOccupantListener(callEverybodyElse),easyrtc.easyApp("easyrtc.multiparty","box0",["box1","box2","box3"],loginSuccess),easyrtc.setDisconnectListener(function(){easyrtc.showError("LOST-CONNECTION","Lost connection to signaling server")}),easyrtc.setOnCall(function(a,b){console.log("getConnection count="+easyrtc.getConnectionCount()),boxUsed[b+1]=!0,document.getElementById(getIdOfBox(b+1)).style.visibility="visible"}),easyrtc.setOnHangup(function(a,b){boxUsed[b+1]=!1,setTimeout(function(){document.getElementById(getIdOfBox(b+1)).style.visibility="hidden"},20)})}var fb=new Firebase("https://hrr-kitchen-legacy.firebaseio.com/"),seating=fb.child("seating"),seatClick=function(a){var b="Rory",c=a.table,d=a.seat,e=seating.child(c).child(d);e.set({taken:!0,name:b})},activeBox=-1,aspectRatio=4/3,maxCALLERS=3,numVideoOBJS=maxCALLERS+1,layout;easyrtc.dontAddCloseButtons(!0);var boxUsed=[!0,!1,!1,!1],connectCount=0,fbChats=new Firebase("https://hrr-kitchen-legacy.firebaseio.com/chats"),appControllers=angular.module("appControllers");appControllers.controller("chatCtrl",["$scope","$cookies",function(a,b){function c(a,b){$("<div/>").text(b).prepend($("<strong/>").text(a+": ")).appendTo($(".chat")),$(".chat")[0].scrollTop=$(".chat")[0].scrollHeight}var d={};d.name=b.user?b.user:"Anonymous",$("#messageInput").keypress(function(a){if(13==a.keyCode){var b=$("#messageInput").val();fbChats.push({name:d.name,text:b}),$("#messageInput").val("")}}),fbChats.on("child_added",function(a){var b=a.val();c(b.name,b.text)})}]),window.userName="Loading";var fbHangouts=new Firebase("https://hrr-kitchen-legacy.firebaseio.com/hangouts"),appControllers=angular.module("appControllers",["ngCookies"]);appControllers.controller("kitchenCtrl",["$scope","$cookies",function(a,b){window.userName=b.user?b.user:"Anonymous",a.satDown=!1,a.currentSeat="standing",a.currentURL="No current hangout url",a.seats={},a.hangouts={},fbSeating.on("value",function(b){a.$apply(function(){a.seats=b.val()})}),fbHangouts.on("value",function(b){a.$apply(function(){a.hangouts=b.val()})}),a.viewThumbs=viewThumbVideos,a.doClick=function(b,c){handleClick(b,c,a)},a.clearRoom=clearRoom}]);var fbSeating=new Firebase("https://hrr-kitchen-legacy.firebaseio.com/seating"),kitchenApp=angular.module("kitchenApp",["ui.bootstrap","ngRoute","appControllers"],function(a){a.startSymbol("{%"),a.endSymbol("%}")});kitchenApp.config(["$routeProvider",function(a){a.when("/index",{templateUrl:"/partials/kitchenView.html",controller:"kitchenCtrl"}).otherwise({redirectTo:"/index"})}]);var startOrJoinVideo=function(a,b){var c=b.hangouts[a.tableNumber];joinThumbVideos(a.tableNumber),0===c.users?(c.users++,bootbox.alert("Creating a video group chat! Allow the kitchen app to access your camera."),$(".modal-backdrop").css("z-index","0"),b.$apply(function(){console.log("SEAT",a,c),b.currentURL=c.url,b.currentSeat=a.tableNumber+" - "+a.seatNumber}),window.open("https://appear.in/hrr-kitchen-"+a.tableNumber),fbHangouts.set(b.hangouts)):(window.open("https://appear.in/hrr-kitchen-"+a.tableNumber),bootbox.alert("Joining a video chat! Allow the kitchen app to access your camera."),$(".modal-backdrop").css("z-index","0"),b.$apply(function(){b.currentURL=c.url,b.currentSeat=a.tableNumber+" - "+a.seatNumber}),fbHangouts.set(b.hangouts))},handleClick=function(a,b,c){if(b.preventDefault(),c.satDown)if(a.name===userName){a.name="empty",a.taken=!1,c.satDown=!1,c.currentSeat="standing",c.currentURL="No current hangout url",fbSeating.set(c.seats);var d=c.hangouts[a.tableNumber];d.users--,c.currentSeat="Standing"}else bootbox.alert("You're already sat down"),$(".modal-backdrop").css("z-index","0");else a.taken?(bootbox.alert("Seat already occupied"),$(".modal-backdrop").css("z-index","0")):(c.currentSeat=a.seatNumber,a.name=userName,a.taken=!0,c.satDown=!0,fbSeating.set(c.seats),startOrJoinVideo(a,c))},clearRoom=function(){var a={table1:{users:0,message:0,url:0},table2:{users:0,message:0,url:0},table3:{users:0,message:0,url:0},table4:{users:0,message:0,url:0}},b={table1:{seat1:{name:"empty",seatNumber:"seat1",tableNumber:"table1",taken:!1},seat2:{name:"empty",seatNumber:"seat2",tableNumber:"table1",taken:!1},seat3:{name:"empty",seatNumber:"seat3",tableNumber:"table1",taken:!1},seat4:{name:"empty",seatNumber:"seat4",tableNumber:"table1",taken:!1},tableNumber:"table1"},table2:{seat1:{name:"empty",seatNumber:"seat1",tableNumber:"table2",taken:!1},seat2:{name:"empty",seatNumber:"seat2",tableNumber:"table2",taken:!1},seat3:{name:"empty",seatNumber:"seat3",tableNumber:"table2",taken:!1},seat4:{name:"empty",seatNumber:"seat4",tableNumber:"table2",taken:!1},tableNumber:"table2"},table3:{seat1:{name:"empty",seatNumber:"seat1",tableNumber:"table3",taken:!1},seat2:{name:"empty",seatNumber:"seat2",tableNumber:"table3",taken:!1},seat3:{name:"empty",seatNumber:"seat3",tableNumber:"table3",taken:!1},seat4:{name:"empty",seatNumber:"seat4",tableNumber:"table3",taken:!1},tableNumber:"table2"},table4:{seat1:{name:"empty",seatNumber:"seat1",tableNumber:"table4",taken:!1},seat2:{name:"empty",seatNumber:"seat2",tableNumber:"table4",taken:!1},seat3:{name:"empty",seatNumber:"seat3",tableNumber:"table4",taken:!1},seat4:{name:"empty",seatNumber:"seat4",tableNumber:"table4",taken:!1},tableNumber:"table2"}};fbHangouts.set(a),fbSeating.set(b)};